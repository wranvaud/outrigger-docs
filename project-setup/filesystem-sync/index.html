<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="Phase2">
  <link rel="shortcut icon" href="../../favicon.ico">
  
  <title>Filesystem Sync - Outrigger Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Filesystem Sync";
    var mkdocs_page_input_path = "project-setup/filesystem-sync.md";
    var mkdocs_page_url = "/project-setup/filesystem-sync/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
  <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-305109-83', 'auto');
      ga('send', 'pageview');
  </script>
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Outrigger Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Getting Started</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../getting-started/system-requirements/">System Requirements</a>
                </li>
                <li class="">
                    
    <a class="" href="../../getting-started/mac-installation/">Mac Installation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../getting-started/linux-installation/">Linux Installation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../getting-started/windows-installation/">Windows Installation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../getting-started/first-steps/">First Steps</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Project Setup</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../key-concepts/">Key Concepts</a>
                </li>
                <li class="">
                    
    <a class="" href="../new-projects/">New Projects</a>
                </li>
                <li class="">
                    
    <a class="" href="../existing-projects/">Existing Projects</a>
                </li>
                <li class="">
                    
    <a class="" href="../project-configuration/">Project Configuration</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Filesystem Sync</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#filesystem-sync">Filesystem Sync</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#sync-volume-name">Sync Volume Name</a></li>
        
            <li><a class="toctree-l4" href="#setting-up-sync-for-your-containers">Setting up sync for your containers</a></li>
        
            <li><a class="toctree-l4" href="#start-it-up">Start it up</a></li>
        
            <li><a class="toctree-l4" href="#cleaning-up">Cleaning up</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../docker-images/">Docker Images</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Common Tasks</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../common-tasks/starting-your-project-containers/">Starting your project containers</a>
                </li>
                <li class="">
                    
    <a class="" href="../../common-tasks/stopping-containers-and-cleanup/">Stopping containers and cleanup</a>
                </li>
                <li class="">
                    
    <a class="" href="../../common-tasks/using-the-build-container/">Using the build container</a>
                </li>
                <li class="">
                    
    <a class="" href="../../common-tasks/working-with-volumes/">Working with Volumes</a>
                </li>
                <li class="">
                    
    <a class="" href="../../common-tasks/working-offline/">Working Offline</a>
                </li>
                <li class="">
                    
    <a class="" href="../../common-tasks/ssh-into-a-container/">SSH into a container</a>
                </li>
                <li class="">
                    
    <a class="" href="../../common-tasks/customizing-container-configuration/">Changing container configuration</a>
                </li>
                <li class="">
                    
    <a class="" href="../../common-tasks/using-watches/">Using watches</a>
                </li>
                <li class="">
                    
    <a class="" href="../../common-tasks/using-xdebug-with-phpstorm/">Using Xdebug with PHPStorm</a>
                </li>
                <li class="">
                    
    <a class="" href="../../common-tasks/accessing-logs/">Accessing logs</a>
                </li>
                <li class="">
                    
    <a class="" href="../../common-tasks/inter-vm-communication/">Accessing containers from other VMs</a>
                </li>
                <li class="">
                    
    <a class="" href="../../common-tasks/ssh-keys-for-private-repos/">SSH Keys for private repos</a>
                </li>
                <li class="">
                    
    <a class="" href="../../common-tasks/setting-up-mail/">Seting up mail</a>
                </li>
                <li class="">
                    
    <a class="" href="../../common-tasks/dns-resolution/">DNS Resolution</a>
                </li>
                <li class="">
                    
    <a class="" href="../../common-tasks/upgrading-rig/">Upgrading Rig</a>
                </li>
                <li class="">
                    
    <a class="" href="../../common-tasks/multiple-docker-machines/">Multiple Docker Machines</a>
                </li>
                <li class="">
                    
    <a class="" href="../../common-tasks/routine-image-maintenance/">Routine Image Maintenance</a>
                </li>
                <li class="">
                    
    <a class="" href="../../common-tasks/creating-your-own-images/">Creating your own images</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">FAQ</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../faq/general/">General</a>
                </li>
                <li class="">
                    
    <a class="" href="../../faq/troubleshooting/">Troubleshooting</a>
                </li>
                <li class="">
                    
    <a class="" href="../../faq/docker-for-mac/">Docker for Mac</a>
                </li>
                <li class="">
                    
    <a class="" href="../../faq/how-to-contribute/">How to contribute</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Appendix</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../appendix/glossary/">Glossary</a>
                </li>
                <li class="">
                    
    <a class="" href="../../appendix/architecture/">Architecture</a>
                </li>
                <li class="">
                    
    <a class="" href="../../appendix/background/">Background</a>
                </li>
                <li class="">
                    
    <a class="" href="../../appendix/library/">Library</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Outrigger Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Project Setup &raquo;</li>
        
      
    
    <li>Filesystem Sync</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/phase2/outrigger-docs/edit/master/docs/project-setup/filesystem-sync.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="filesystem-sync">Filesystem Sync</h1>
<p>The default NFS filesystems that Outrigger sets up provides easy sharing of code and files with your project containers. 
However, NFS can be slow when writing, reading, or scanning thousands of files when compared to native filesystem performance. 
Some modern tool kits and package managers favor large numbers of small files and libraries so maintaining high performance 
of a build becomes challenging when your code base is on a volume mounted NFS share.</p>
<p>NFS also has the downside of not propagating filesystem modification events. This can be problematic if you want to run
a process in your container to rebuild or update compiled project assets when modification notifications are triggered
due to local file editing in your IDE.</p>
<p>In order to better support these types of operations, Outrigger provides support for multi-directional filesystem syncing 
(which includes filesystem notifications) using <code>unison</code>.  Your project root folder is synced via <code>unison</code> into a sync 
container and exposed as a Docker Volume to the rest of your application. This volume is then used as your mount point 
instead of the NFS share and allows nearly native filesystem performance and features.</p>
<h2 id="sync-volume-name">Sync Volume Name</h2>
<p>The name of the sync volume can be set in a variety of ways. It is determined using the following precedence:</p>
<ol>
<li>Argument provided to the <code>project sync:start</code> command</li>
<li>Specified in the <code>sync</code> -&gt; <code>volume-name</code> property of your <a href="../project-configuration/">Outrigger Project Configuration</a></li>
<li>In your <code>docker-compose.yml</code> file, specified as an <code>external</code> volume with a name of the pattern <code>*-sync</code></li>
<li>If not specified anywhere else, it will use the name of the current project folder with <code>-sync</code> appended</li>
</ol>
<p>We recommend using approach #3, as it is the most explicit and is in line with all of the configuration you will need
to take full advantage of <code>unison</code> syncing.</p>
<h2 id="setting-up-sync-for-your-containers">Setting up sync for your containers</h2>
<p>To setup <code>unison</code> sync for your containers you will need to <a href="https://docs.docker.com/compose/compose-file/#volume-configuration-reference">reference an external volume</a> 
in your <code>docker-compose.yml</code> and use that external volume in the mount specification for any services that need to 
reference the same set of files to ensure all containers stay in sync. Also specifying the sync volume in your <code>build.yml</code>
file for any containers that reference your code base will have a considerable performance improvement.</p>
<p><strong>Add the volume spec to your compose file</strong></p>
<p>This needs to be placed at the root level. It cannot be a child of <code>services</code>.</p>
<pre><code class="yaml">volumes:
  project-sync:
    external: true
</code></pre>

<div class="admonition important">
<p class="admonition-title">Note about volume name</p>
<p>If you optionally specified a volume name to the <code>project sync:start</code> command or configured a name in your Outrigger 
Project Configuration file the name in this volumes section must match the one specified to the <code>project sync:start</code>
command. The reason why we don't exclusively grab the volume name from the compose file is that this volume may be 
managed outside of Outrigger by another tool and we want to support named volumes that don't precisely follow 
the <code>*-sync</code> convention we lay out here. </p>
</div>
<p><strong>Use the external volume as your local mount point</strong></p>
<pre><code class="yaml">services:
  build:
    image: outrigger/build:php71
    volumes:
      - project-sync:/var/www
</code></pre>

<h2 id="start-it-up">Start it up</h2>
<p>From your project root run the command <code>rig project sync:start</code> (there is also an alias <code>rig project sync</code>) to get going.<br />
With the above configuration you should be up and running. The initial sync can take a few seconds depending on the size
of your project folder. You will see a progress indicator that will let you know when the initial sync is finished and 
things are ready to use.</p>
<h2 id="cleaning-up">Cleaning up</h2>
<p>Since the <code>project sync:start</code> command starts another container to manage the volume syncing, we have a command <code>project sync:stop</code>
that will clean up that running container for you. It discovers the volume / container name the same way <code>project sync:start</code> 
does.</p>
<p>When you are done for the day, or for that project, from the project root <code>rig project sync:stop</code> will clean up any running
<code>unison</code> containers for that project.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../docker-images/" class="btn btn-neutral float-right" title="Docker Images">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../project-configuration/" class="btn btn-neutral" title="Project Configuration"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/phase2/outrigger-docs" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../project-configuration/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../docker-images/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>

</body>
</html>
